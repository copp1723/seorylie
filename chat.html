<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Assistant Chat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-container {
            background: white;
            width: 90%;
            max-width: 800px;
            height: 80vh;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .chat-header h1 {
            font-size: 24px;
            color: #333;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .message {
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }
        
        .message.assistant .message-avatar {
            background: #4F46E5;
        }
        
        .message.user .message-avatar {
            background: #10B981;
        }
        
        .message-content {
            background: #f3f4f6;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 70%;
        }
        
        .message.user .message-content {
            background: #4F46E5;
            color: white;
        }
        
        .action-card {
            background: #EFF6FF;
            border: 1px solid #DBEAFE;
            padding: 16px;
            border-radius: 8px;
            margin-top: 8px;
        }
        
        .action-card h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #1E40AF;
        }
        
        .action-card button {
            background: #3B82F6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 8px;
        }
        
        .action-card button:hover {
            background: #2563EB;
        }
        
        .chat-input {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 12px;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .chat-input button {
            background: #4F46E5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chat-input button:hover {
            background: #4338CA;
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
            }
            30% {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>ðŸ¤– SEO Assistant</h1>
            <p style="color: #666; margin-top: 4px;">Powered by Rylie SEO</p>
        </div>
        
        <div class="chat-messages" id="messages">
            <div class="message assistant">
                <div class="message-avatar">AI</div>
                <div class="message-content">
                    <p>Hello! I'm your SEO assistant. How can I help you improve your website's search engine optimization today?</p>
                </div>
            </div>
        </div>
        
        <div class="chat-input">
            <input 
                type="text" 
                id="messageInput" 
                placeholder="Ask me about SEO, keywords, or submit a request..."
                onkeypress="if(event.key === 'Enter') sendMessage()"
            >
            <button onclick="sendMessage()">
                Send
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        const messagesContainer = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        let isTyping = false;

        // Predefined responses for demo
        const responses = {
            keywords: {
                content: "I can help you with keyword research! Here are some key strategies:\n\nâ€¢ Focus on long-tail keywords (3-4 words)\nâ€¢ Check search volume and competition\nâ€¢ Use tools like Google Keyword Planner\nâ€¢ Analyze competitor keywords\n\nWould you like me to analyze keywords for your specific industry?",
                action: {
                    title: "Get Keyword Analysis",
                    description: "Our SEO team can perform a comprehensive keyword analysis for your business",
                    buttonText: "Submit Request to SEO Team"
                }
            },
            analytics: {
                content: "I can help you understand your website analytics! Key metrics to track:\n\nâ€¢ Organic traffic growth\nâ€¢ Bounce rate\nâ€¢ Page load speed\nâ€¢ Conversion rate\nâ€¢ Top performing pages\n\nWould you like a detailed analytics report?",
                action: {
                    title: "Weekly Analytics Report",
                    description: "Get automated weekly reports on your SEO performance",
                    buttonText: "Enable Weekly Reports"
                }
            },
            default: {
                content: "I can help you with:\n\nâ€¢ Keyword research and optimization\nâ€¢ Content strategy\nâ€¢ Technical SEO audits\nâ€¢ Competitor analysis\nâ€¢ Local SEO optimization\nâ€¢ Analytics and reporting\n\nWhat specific area would you like to focus on?",
                action: null
            }
        };

        function addMessage(content, sender = 'user') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'U' : 'AI';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = `<p>${content.replace(/\n/g, '<br>')}</p>`;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return contentDiv;
        }

        function addTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant';
            typingDiv.id = 'typing-indicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'AI';
            
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(indicator);
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }

        function addActionCard(action, messageContent) {
            if (!action) return;
            
            const actionCard = document.createElement('div');
            actionCard.className = 'action-card';
            actionCard.innerHTML = `
                <h3>${action.title}</h3>
                <p>${action.description}</p>
                <button onclick="submitRequest('${action.title}')">${action.buttonText}</button>
            `;
            
            messageContent.appendChild(actionCard);
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isTyping) return;
            
            messageInput.value = '';
            addMessage(message, 'user');
            
            isTyping = true;
            addTypingIndicator();
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
            
            // Determine response based on keywords
            let response = responses.default;
            if (message.toLowerCase().includes('keyword')) {
                response = responses.keywords;
            } else if (message.toLowerCase().includes('analytics') || message.toLowerCase().includes('report')) {
                response = responses.analytics;
            }
            
            removeTypingIndicator();
            const messageContent = addMessage(response.content, 'assistant');
            addActionCard(response.action, messageContent);
            
            isTyping = false;
        }

        async function submitRequest(requestType) {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Submitting...';
            
            try {
                const response = await fetch('/api/seoworks/webhook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: `chat-${Date.now()}`,
                        task_type: 'seo_request',
                        status: 'pending',
                        request_type: requestType,
                        source: 'chat_assistant',
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    button.textContent = 'âœ“ Request Submitted';
                    addMessage(`Great! I've submitted your request for "${requestType}". Our SEO team will review it and get back to you within 24 hours.`, 'assistant');
                } else {
                    throw new Error('Failed to submit');
                }
            } catch (error) {
                button.textContent = 'Try Again';
                button.disabled = false;
                addMessage('Sorry, there was an error submitting your request. Please try again.', 'assistant');
            }
        }
    </script>
</body>
</html>